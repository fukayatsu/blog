<!DOCTYPE html>
<html>
<head><meta charset='utf-8'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<meta content='width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
<meta content='help/ファイルアップロード先に独自のS3 Bucketを設定する - esa blog' property='og:title'>
<meta content='website' property='og:type'>
<meta content='http://blog-test.fukayatsu.com/posts/81.html' property='og:url'>
<meta content='images/og-image.png' property='og:image'>
<link href='images/favicon.ico' rel='shortcut icon'>
<title>help/ファイルアップロード先に独自のS3 Bucketを設定する - esa blog</title>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/stylesheets/screen.css" rel="stylesheet" media="all" />
</head>
<body class='posts-show sharing-post'>
<nav class='navbar-published'>
<a class="navbar-brand" href="/"><img alt="esa.io" class="navbar-brand__icon" src="/images/logo-toriatama.svg" />
<span class='navbar-brand__title'>esa blog</span>
</a></nav>

<div class='body'>
<div class='container row'>
<div class='posts-header'>
<div class='page-heading'>
<div class='posts-title'>
<ul class='categories'>
<li><a href="/categories/help">help</a></li>
</ul>
<h1 class='title'>
ファイルアップロード先に独自のS3 Bucketを設定する
</h1>
</div>
<div class='published-time'>
<i class='fa fa-share-square-o'></i>
Updated at<span class='num'>2015-11-08 08:31:46 +0000</span></div>
</div>
</div>
<div class='main-column' id='main' role='main'>
<div class='post-body markdown'><p>esa.ioでは、添付ファイルのアップロード先を独自のS3 Bucketに設定することができます。<br>
独自のS3 Bucketを使うことで、ファイルサイズ制限の拡大やセキュリティ面などにメリットがあります。</p>

<h1>独自のS3 Bucketを使用する方法</h1>

<p>もしあなたのチームが、独自のAmazon S3 bucketをお持ちで、記事やコメントに貼り付ける画像やファイルをesa.ioのサーバ上に置きたくない場合、独自のAmazon S3 bucketにファイルを保存することができます。</p>

<p><strong>注意</strong></p>

<ul>
<li>独自のS3 Bucketを使う設定をした場合はesa.ioのサーバ上には記事やコメントに添付されたファイルは保存されません。ファイルの管理は各自でお願い致します。</li>
<li>S3 Bucketは無料ではありません。 S3 Bucketのご利用料金はesa.ioのご利用料金とは別にAmazon Web Servicesに支払う必要があります。

<ul>
<li>設定を開始する前に、<a target="_blank" href="http://aws.amazon.com/jp/s3/pricing/?nc1=f_ls">料金 - Amazon S3</a>をお読みになってから本当に設定すべきかどうかをお考え下さい。</li>
</ul>
</li>
</ul>

<p>独自のS3 Bucketを使うことに関して不明点がある場合は お気軽に info@esa.io までお問い合わせ下さい</p>

<h2>独自S3 Bucketを使った場合の違い</h2>

<table>
<thead>
<tr>
<th></th>
<th>デフォルト</th>
<th>独自S3 Bucket</th>
</tr>
</thead>
<tbody>
<tr>
<td>最大ファイルサイズ</td>
<td>5MB</td>
<td>20MB</td>
</tr>
<tr>
<td>画像へのCDN適用</td>
<td>○</td>
<td>x</td>
</tr>
</tbody>
</table>

<h2>設定手順</h2>

<h3>1. S3 Bucketの作成</h3>

<ul>
<li>AWS ConsoleのDashboardからS3を選び"Create Bucket"します</li>
<li>bucket名は任意です(今回は<code>esa-custom-bucket-test</code>にしました)</li>
<li>regionはチームがいる場所に近い方がUploadが速いのでおすすめです</li>
</ul>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6275/image/789622a61bf24991c37fcd1738654f27.png" alt="AWS_Management_Console.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6276/image/5bc9115feeae2e48bf90e212bddba7a1.png" alt="S3_Management_Console_と_esa_-_Google_Search.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6255/image/f282be21fb715f2fa210baea07c65813.png" alt="ss 2015-03-07 21.32.03.png"></p>

<h4>CORSの設定</h4>

<ul>
<li>S3にCORSの設定をします</li>
</ul>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6273/image/3f96fb172161116c19eb23a722a6d681.png" alt="S3_Management_Console.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6267/image/168051d662764fbba1f556a5da88eae0.png" alt="ss 2015-03-07 22.29.34.png"></p>
<div class="code-block">
<pre class="highlight plaintext"><code>&lt;CORSConfiguration&gt;
    &lt;CORSRule&gt;
        &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;
        &lt;AllowedMethod&gt;POST&lt;/AllowedMethod&gt;
        &lt;MaxAgeSeconds&gt;3000&lt;/MaxAgeSeconds&gt;
        &lt;AllowedHeader&gt;*&lt;/AllowedHeader&gt;
    &lt;/CORSRule&gt;
&lt;/CORSConfiguration&gt;
</code></pre>
</div>
<h3>2. IAMでUserを追加</h3>

<ul>
<li>User名は任意です(今回は <code>esa-user</code> にしました)</li>
<li>Userを作るとAccess Keyが発行されるので控えておきます。</li>
</ul>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6256/image/5c8fc1a680a8f1db949da41ebb8fd7c5.png" alt="ss 2015-03-07 21.38.42.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6257/image/4aea1f487311532ca9106cd76a820058.png" alt="ss 2015-03-07 21.40.57.png"></p>

<h3>3. IAMでCustom Policyの作成</h3>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6268/image/0f19df6ef6311dca4e27d5c36d54f4c1.png" alt="ss 2015-03-07 22.58.22.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6269/image/988069696b32cf69fae4e4825784e32b.png" alt="ss 2015-03-07 22.59.14.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6271/image/9de0233b35adc1facf7de061e913040f.png" alt="ss 2015-03-07 23.07.25.png"></p>
<div class="code-block">
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Stmt1425733999000"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"s3:DeleteObject"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:GetObject"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:ListBucket"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:PutObject"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"s3:PutObjectAcl"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::esa-custom-bucket-test"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"arn:aws:s3:::esa-custom-bucket-test/*"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
<p>※ esa-custom-bucket-testの部分は1. で作ったbucket名に置き換えて下さい</p>

<h3>4. IAMでUser Policyの紐付け</h3>

<ul>
<li>2.で追加したユーザに3. で作成したpolicyを紐付けます</li>
</ul>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6262/image/c11a9eeb7c787cd3d0002d9e947d40a5.png" alt="ss 2015-03-07 21.58.17.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6264/image/fb058271408f1ffbe6e1ce64810999d5.png" alt="ss 2015-03-07 22.17.33.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6265/image/57cfa7571ebe67a28004e496e90950b6.png" alt="ss 2015-03-07 22.18.52.png"></p>

<h3>5. Bucket EndpointとAccess Keyをesa.ioに設定</h3>

<ul>
<li>Bucket EndpointとAccess KeyをTeam管理ページのAdminメニューで設定します</li>
<li>Bucket Endpointは<code>[bucket name].[S3 Endpoint]</code>の形式になっています

<ul>
<li><a target="_blank" href="http://docs.aws.amazon.com/ja_jp/general/latest/gr/rande.html#s3_region">S3 Endpointの一覧はこちら</a></li>
</ul>
</li>
</ul>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6260/image/dd94ed11bce39ef3b92ae39c028ebaf9.png" alt="ss 2015-03-07 21.54.56.png"></p>

<p>↓</p>

<p><img src="https://img.esa.io/uploads/production/pictures/105/6261/image/f8d4161db420db0716f7257169370d65.png" alt="ss 2015-03-07 21.55.36.png"></p>

<h3>6. アップロードを試してみる</h3>

<p>以上で設定は完了です。お疲れ様でした。<br>
正しく設定されていれば、1. で設定したbucketにファイルがアップロードされるはずです。</p>

<p>アップロードがうまくいかない場合は、以下の点をもう一度お確かめ下さい</p>

<ul>
<li>S3のCORS設定は正しいか</li>
<li>IAM UserにS3にアクセス権限のあるPolicyが紐付いているか</li>
<li>Bucket Endpointがesa.io上に正しく設定されているか</li>
</ul>

<p>解決しない場合は、 info@esa.io までお問い合わせ下さい</p></div>
</div>
<div class='right-column'><aside class='side-bar'>
<section class='section'>
<h2 class='side-bar__heading'>
<i class='fa fa-file-text-o'></i>
Recent Articles
</h2>
<div class='side-bar__content'>
<ul class='posts-list side-bar__posts-list'>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/12">記法
</a></h4>
<div class='date'>2015 - 11 - 14</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/15">記事の書き方
</a></h4>
<div class='date'>2015 - 11 - 14</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/7">投稿テンプレート
</a></h4>
<div class='date'>2015 - 11 - 13</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/74">ご利用料金について
</a></h4>
<div class='date'>2015 - 11 - 11</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>ProTip</li>
<li>2015</li>
<li>01</li>
<li>07</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/43">スクリプトタグの埋め込み
</a></h4>
<div class='date'>2015 - 11 - 11</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/49">Markdown記法
</a></h4>
<div class='date'>2015 - 11 - 11</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/25">esa.io 紹介記事
</a></h4>
<div class='date'>2015 - 11 - 10</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>ProTip</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/63">いろいろな(⁰⊖⁰)
</a></h4>
<div class='date'>2015 - 11 - 10</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/81">ファイルアップロード先に独自のS3 Bucketを設定する
</a></h4>
<div class='date'>2015 - 11 - 08</div>
</li>
<li class='post-list'>
<ul class='categories'>
<li>help</li>
</ul>
<h4 class='title'>
<a class="bare-name" href="/posts/8">キーボードショートカット
</a></h4>
<div class='date'>2015 - 11 - 05</div>
</li>
</ul>
</div>
</section>
<section class='section'>
<h2 class='side-bar__heading'>
<i class='fa fa-tag'></i>
Tags
</h2>
<ol class='side-bar__list'>
<li>
<a href="/tags/chromeextension">ChromeExtension
<span class='count-num'>2</span>
</a></li>
<li>
<a href="/tags/editor">editor
<span class='count-num'>1</span>
</a></li>
<li>
<a href="/tags/markdown">markdown
<span class='count-num'>2</span>
</a></li>
<li>
<a href="/tags/tags">tags
<span class='count-num'>1</span>
</a></li>
<li>
<a href="/tags/仕様変更">仕様変更
<span class='count-num'>1</span>
</a></li>
</ol>
</section>
<section class='section'>
<h2 class='side-bar__heading'>
<i class='fa fa-folder-o'></i>
Category
</h2>
<ol class='side-bar__list'>
<li>
<a href="/categories/help">help
<span class='count-num'>16</span>
</a></li>
<li>
<a href="/categories/release_note">release_note
<span class='count-num'>60</span>
</a></li>
<li>
<a href="/categories/no_category">no_category
<span class='count-num'>1</span>
</a></li>
<li>
<a href="/categories/incident_reports">incident_reports
<span class='count-num'>1</span>
</a></li>
<li>
<a href="/categories/templates">templates
<span class='count-num'>3</span>
</a></li>
<li>
<a href="/categories/ProTip">ProTip
<span class='count-num'>5</span>
</a></li>
<li>
<a href="/categories/dev">dev
<span class='count-num'>1</span>
</a></li>
<li>
<a href="/categories/policies">policies
<span class='count-num'>3</span>
</a></li>
</ol>
</section>
</aside>
</div>
</div>
</div>
<div class='footer'>
<div class='footer__brand'>
<a target="_blank" href="https://esa.io"><img alt="esa" class="footer__logo" src="/images/footer-logotype.svg" />
<span class='footer__tagline'>Expertise Sharing Archives for motivated teams.</span>
</a></div>
<ul class='footer__nav'>
<li><a target="_blank" href="https://docs.esa.io/posts/18">Help</a></li>
<li><a target="_blank" href="https://esa.io/pricing">Pricing</a></li>
<li><a target="_blank" href="https://docs.esa.io/posts/5">Terms</a></li>
<li><a target="_blank" href="https://docs.esa.io/posts/6">Privacy</a></li>
<li><a target="_blank" href="https://docs.esa.io/posts/39">Act on Specified Commercial Transactions</a></li>
<li><a target="_blank" href="https://docs.esa.io/">Documents</a></li>
<li><a target="_blank" href="https://docs.esa.io/#path=%2Fdev">Developers</a></li>
<li><a target="_blank" href="https://team.esa.io">Company</a></li>
</ul>
<p class='footer__copyright'>
This page has been published from
<a target="_blank" href="https://esa.io">esa.io</a>
.
This template by esa LLC under a MIT licence.
</p>
</div>

</body>
</html>
